# 后端 Dockerfile
# 使用 node:20 作为基础镜像

# 从 Docker Hub 拉取 node:20 镜像作为基础镜像
FROM node:20

# 设置工作目录，后续命令都在这个目录下执行
WORKDIR /app

# 复制 package.json 和 package-lock.json（如果存在）到工作目录
# 这一步的目的是先安装依赖，然后再复制其他文件
# 这样可以利用 Docker 的缓存机制，只有当 package.json 变化时才会重新安装依赖
COPY package*.json ./

# 安装项目依赖
RUN npm install

# 复制所有文件到工作目录
# 现在复制文件，是因为如果先复制文件，那么每次修改代码都会重新安装依赖，导致构建变慢
COPY . .

# 暴露 3000 端口
# 这个命令只是声明容器会使用 3000 端口，实际的端口映射在 docker-compose.yml 中配置
EXPOSE 3000

# 启动后端服务
# 使用 node index.js 命令启动服务
CMD ["node", "index.js"]
