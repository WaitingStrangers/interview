# Docker Compose 配置文件
# 用于定义和运行多个 Docker 容器

# 定义所有服务
# services 是 docker-compose.yml 的核心部分，包含所有需要启动的容器服务

# 前端服务配置
services:
  # 服务名称：frontend
  frontend:
    # 构建配置
    build:
      # 构建上下文：使用 ./Interview 目录作为构建上下文
      # 构建上下文是 Docker 构建时的工作目录
      context: ./Interview
      # 指定 Dockerfile：使用 ./Interview/dockerfile 文件
      dockerfile: dockerfile
    # 网络配置：将前端服务连接到 app-network 网络
    networks:
      - app-network
    # 依赖关系：前端服务依赖于 backend 服务
    # 这意味着 backend 服务会先启动，然后再启动 frontend 服务
    depends_on:
      - backend

  # 后端服务配置
  backend:
    # 构建配置
    build:
      # 构建上下文：使用 ./ServiceNode 目录作为构建上下文
      context: ./ServiceNode
      # 指定 Dockerfile：使用 ./ServiceNode/dockerfile 文件
      dockerfile: dockerfile
    # 网络配置：将后端服务连接到 app-network 网络
    networks:
      - app-network
    # 端口映射：将主机的 3000 端口映射到容器的 3000 端口
    # 这样可以通过 http://localhost:3000 直接访问后端服务
    ports:
      - "3000:3000"
    # 环境变量配置：设置后端服务需要的环境变量
    # 这些环境变量用于连接数据库
    environment:
      - DB_HOST=host.docker.internal  # 数据库主机：连接宿主机上的 MySQL
      - DB_USER=root                  # 数据库用户名
      - DB_PASSWORD=root123           # 数据库密码
      - DB_NAME=interview             # 数据库名称
      - DB_PORT=3306                  # 数据库端口

  # Nginx 服务配置
  nginx:
    # 镜像配置：使用 nginx:alpine 镜像
    # alpine 是一个轻量级的 Linux 发行版，镜像体积更小
    image: nginx:alpine
    # 端口映射：将主机的 80 端口映射到容器的 80 端口
    # 这样可以通过 http://localhost 访问 Nginx 服务
    ports:
      - "80:80"
    # 网络配置：将 Nginx 服务连接到 app-network 网络
    networks:
      - app-network
    # 依赖关系：Nginx 服务依赖于 frontend 和 backend 服务
    # 这意味着 frontend 和 backend 服务会先启动，然后再启动 Nginx 服务
    depends_on:
      - frontend
      - backend
    # 卷挂载配置：将主机的 ./Nginx/default.conf 文件挂载到容器的 /etc/nginx/conf.d/default.conf
    # 这样可以在不重新构建镜像的情况下修改 Nginx 配置
    volumes:
      - ./Nginx/default.conf:/etc/nginx/conf.d/default.conf

# 网络配置
# 定义一个名为 app-network 的网络，使用 bridge 驱动
networks:
  # 网络名称：app-network
  app-network:
    # 网络驱动：bridge
    # bridge 是 Docker 的默认网络驱动，允许同一网络内的容器相互通信
    driver: bridge